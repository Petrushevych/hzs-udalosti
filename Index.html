<!DOCTYPE html>
<html lang="cs">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>Ud√°losti HZS FIVEPD</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  font-family: Arial, sans-serif;
  display: flex;
  flex-direction: column;
}

#form-box button {
  flex-direction: column;
  align-items: center;
  margin-right: 10px;
  padding: 20px 32px;
  font-weight: bold;
  background-color: #eaeaea;
  border: 1px solid #ccc;
  cursor: pointer;
  border-radius: 4px;
  margin-bottom: 20px;
}

#form-box label {
  font-size: 1.0em;
  font-weight: bold;
  margin-bottom: 8px;
  text-align: center;
  width: 100%;
}

#form-box input[type="text"],
#form-box select {
  padding: 5px;
  font-size: 1em;
  width: 235px;
  margin-bottom: 10px;
  text-align: center;
}

    #map {
      flex-grow: 1;
    }

    #udalosti {
      min-height: 150px;
      max-height: 30vh;
      overflow-y: auto;
      background: #fff;
      border-bottom: 1px solid #ccc;
    }
    
#map {
  height: 100vh;
}

#formular {
  width: 100%;
  padding: 20px;
  box-sizing: border-box;
}
.modal {
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-content {
  background-color: #fff;
  padding: 20px 30px;
  border-radius: 8px;
  box-shadow: 0 0 20px rgba(0,0,0,0.3);
  max-width: 600px;
  width: 90%;
  font-size: 1.2em;
  position: relative;
}

.close-btn {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 1.5em;
  cursor: pointer;
  color: #888;
}

.close-btn:hover {
  color: #000;
}

#poznamka-box {
  position: absolute;
  top: 200px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 1.5em;
  color: white;
  text-shadow: 0 0 5px black;
  white-space: nowrap;
  overflow-x: auto;
  overflow-y: hidden;
  text-overflow: unset;
  background: none;
  border: none;
  padding: 0;
  margin: 0;
  max-width: 90vw;
}

#pozice-box {
  position: fixed;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.8);
  color: #fff;
  padding: 16px 32px;
  border-radius: 12px;
  font-size: 1.6em;
  font-weight: bold;
  display: none;
  z-index: 999;
  white-space: nowrap;
  box-shadow: 0 0 15px rgba(0,0,0,0.4);
  letter-spacing: 0.5px;
}

#firebase-box {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0, 128, 0, 0.85); /* zelen√© pozad√≠ */
  color: white;
  padding: 20px 40px;
  border-radius: 12px;
  font-size: 1.6em;
  font-weight: bold;
  display: none;
  z-index: 999;
  white-space: nowrap;
  box-shadow: 0 0 15px rgba(0,0,0,0.4);
  text-align: center;
}

.modal-content h2 {
  font-size: 0.8em;
  color: #444;
  margin-bottom: 10px;
}

.close-btn {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 1.5em;
  cursor: pointer;
  color: #888;
}

.close-btn:hover {
  color: #000;
}

.radek-akce {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-top: 15px;
  align-items: center;
}

.radek-akce label {
  display: flex;
  align-items: center;
  gap: 5px;
  font-weight: bold;
}

.radek-akce input[type="text"] {
  width: 200px;
  box-sizing: border-box;
}

.radek-akce button {
  padding: 15px 12px;
  font-weight: bold;
  cursor: pointer;
}

.radek-jednotky .popisek {
  font-weight: bold;
  min-width: 150px;
}

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 8px;
      border: 1px solid #ddd;
      text-align: left;
    }

    .info-icon {
      cursor: pointer;
      color: blue;
    }

    #form-box {
      display: none;
    }

    @media print {
      #map, #form-box, #heslo-box {
        display: none;
      }
      #udalosti {
        max-height: none;
        overflow: visible;
      }
    }
  </style>
</head>
<body>

<div id="heslo-box">
  <label>Zadej heslo KOPIS:</label>
  <input type="password" id="heslo" placeholder="">
  <button onclick="overitHeslo()">Odemknout p≈ô√≠stup</button>
</div>

<div id="form-box">
  <label>N√°zev ud√°losti:</label>
  <input type="text" id="nazev" placeholder="Nap≈ô. PO≈Ω√ÅR, DOPRAVN√ç NEHODA">
  <label>Typ:</label>
  <select id="typ">
    <option value="P">Po≈æ√°r</option>
    <option value="DN">Dopravn√≠ nehoda</option>
    <option value="TP">Technick√° pomoc</option>
    <option value="ZOZ">Z√°chrana osob a zv√≠≈ôat</option>
    <option value="UNL">√önik nebezpeƒçn√Ωch l√°tek</option>
    <option value="POP">Poplach</option>
    <option value="OST">Ostatn√≠</option>
  </select>
<label>Ulice + ƒç. p. (automaticky):</label>
<input type="text" id="ulice" style="background-color: #f0f0f0;">

<label>Mƒõsto (automaticky):</label>
<input type="text" id="mesto" style="background-color: #f0f0f0;">

  <label>Stav:</label>
  <select id="stav">
    <option value="P≈ôijat√°, SaP na cestƒõ">P≈ôijat√°, SaP na cestƒõ</option>
    <option value="Otev≈ôen√°, SaP na m√≠stƒõ">Otev≈ôen√°, SaP na m√≠stƒõ</option>
    <option value="Lokalizace">Lokalizace</option>
    <option value="Likvidace">Likvidace</option>
    <option value="P≈ôevzat√° VZ">P≈ôevzat√° VZ</option>
    <option value="P≈ôevzat√° PƒåR">P≈ôevzat√° PƒåR</option>
    <option value="Uzav≈ôen√° OS">Uzav≈ôen√° OS</option>
  </select>
  <label>Popis ud√°losti:</label>
  <input type="text" id="poznamka" placeholder="Nap≈ô. Po≈æ√°r gar√°≈æe, bez zranƒõn√≠">
<div class="radek-jednotky">
  <span class="popisek">Jednotky na m√≠stƒõ:</span>
  <label><input type="checkbox" id="hzs"> HZS</label>
  <label><input type="checkbox" id="jsdh"> JSDH</label>
  <label><input type="checkbox" id="pcr"> PƒåR</label>
  <label><input type="checkbox" id="zzs"> ZZS</label>
</div>
  <button onclick="pridatUdalost()">P≈ôidat ud√°lost</button>
  <button onclick="vymazatUdalosti()">üóëÔ∏è Vymazat ud√°losti</button>
  <button onclick="window.print()">üñ®Ô∏è Vytisknout</button>
  <button onclick="ulozitAOdhlasit()">üíæ Ulo≈æit a odhl√°sit</button>
  </div>

<div id="udalosti">
  <table id="tabulka">
<thead>
  <tr>
    <th>ƒåas</th>
    <th>N√°zev</th>
    <th>Typ</th>
    <th>Ulice</th>
    <th>Mƒõsto</th>
    <th>Stav</th>
    <th>Jednotky</th>
    <th>Popis ud√°losti</th>
  </tr>
</thead>
    <tbody></tbody>
  </table>
</div>

<!-- Mapa -->
<div id="map"></div>

<!-- Modal pro pozn√°mku -->
<div id="poznamka-modal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close-btn" onclick="zavritPoznamku()">√ó</span>
    <h2 style="margin-top: 0;">Popis ud√°losti:</h2>
    <div id="poznamka-text"></div>
  </div>
</div>

<div id="firebase-box"></div>
<audio id="zvuk-udalosti" src="https://files.catbox.moe/c0duwl.mp3"></audio>

<div id="pozice-box"></div>

<!-- Plovouc√≠ pozn√°mka nad mapou -->
<div id="poznamka-box"></div>



<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAf1s7JPna788ymY3ZmnQj6yEIM3H201cQ",
    authDomain: "udalosti-hzs-fivepd.firebaseapp.com",
    databaseURL: "https://udalosti-hzs-fivepd-default-rtdb.firebaseio.com",
    projectId: "udalosti-hzs-fivepd",
    storageBucket: "udalosti-hzs-fivepd.appspot.com",
    messagingSenderId: "1032416028363",
    appId: "1:1032416028363:web:f150ad103ea19b9f7e9d4e"
  };

  firebase.initializeApp(firebaseConfig);
const kanal = new BroadcastChannel("udalosti-kanal");
const mojeId = Math.random().toString(36).substr(2, 9);

kanal.onmessage = (event) => {
  if (event.data.typ === "hlaseni" && event.data.odesilatel !== mojeId) {
    const zvuk = document.getElementById("zvuk-udalosti");
    if (zvuk) {
      zvuk.muted = false;
      zvuk.currentTime = 0;
      zvuk.play();
    }

    const hlaseni = new SpeechSynthesisUtterance(event.data.text);
    hlaseni.lang = "cs-CZ";
    hlaseni.rate = 1;
    hlaseni.pitch = 1;
    speechSynthesis.speak(hlaseni);
  }
};


  const map = L.map('map', {
    crs: L.CRS.Simple,
    minZoom: -2,
    maxZoom: 4
  });

  // ... dal≈°√≠ k√≥d
  
  const bounds = [[0,0], [1024,1024]];
  const image = L.imageOverlay('mapa.png', bounds).addTo(map);
  map.fitBounds(bounds);

  const ikony = {
    "P": L.icon({ iconUrl: 'pozar.png', iconSize: [32, 32], iconAnchor: [32, 32], popupAnchor: [0, -32] }),
    "DN": L.icon({ iconUrl: 'nehoda.png', iconSize: [32, 32], iconAnchor: [32, 32], popupAnchor: [0, -32] }),
    "TP": L.icon({ iconUrl: 'technika.png', iconSize: [32, 32], iconAnchor: [32, 32], popupAnchor: [0, -32] }),
    "ZOZ": L.icon({ iconUrl: 'zachrana.png', iconSize: [32, 32], iconAnchor: [32, 32], popupAnchor: [0, -32] }),
    "UNL": L.icon({ iconUrl: 'unik.png', iconSize: [32, 32], iconAnchor: [32, 32], popupAnchor: [0, -32] }),
    "POP": L.icon({ iconUrl: 'poplach.png', iconSize: [32, 32], iconAnchor: [32, 32], popupAnchor: [0, -32] }),
    "OST": L.icon({ iconUrl: 'ostatn√≠.png', iconSize: [32, 32], iconAnchor: [32, 32], popupAnchor: [0, -32] }),
  };
  
const uliceSeznam = [
  "Masarykova", "Dlouh√°", "Komensk√©ho", "Husova", "≈†koln√≠",
  "N√°dra≈æn√≠", "Jir√°skova", "Palack√©ho", "Smetanova", "Tyr≈°ova",
  "Na V√Ωslun√≠", "Pod P√°te≈ô√≠", "U Lesa", "Kpt. Jaro≈°e", "U H≈ôi≈°tƒõ", "Zahradn√≠", "Cimrmanova", "Sluneƒçn√°", "Politick√°",
];

const mestaSeznam = [
    "√öst√≠ nad Labem", "Praha", "Kl√°≈°terec nad Oh≈ô√≠", "Teplice", "Dƒõƒç√≠n", "Litomƒõ≈ôice", "Most",
    "Chomutov", "Louny", "Roudnice nad Labem", "B√≠lina", "≈Ωatec", "Praha 2", "Praha 3", "Praha 4", "Brno", "Ostrava"
];

  let kliknuteLatLng = null;

map.on('click', function(e) {
  kliknuteLatLng = e.latlng;

  const box = document.getElementById("pozice-box");
  box.innerText = "üìç Vybran√° pozice: " + kliknuteLatLng.lat.toFixed(2) + ", " + kliknuteLatLng.lng.toFixed(2);
  box.style.display = "block";

  setTimeout(() => {
    box.style.display = "none";
  }, 3000);
});

function smazatUdalost(klic) {
  firebase.database().ref("udalosti/" + klic).remove().then(() => {
    const firebaseBox = document.getElementById("firebase-box");
    firebaseBox.innerText = "üóëÔ∏è Ud√°lost byla √∫spƒõ≈°nƒõ smaz√°na!";
    firebaseBox.style.background = "rgba(200,0,0,0.85)";
    firebaseBox.style.display = "block";

    setTimeout(() => {
      firebaseBox.style.display = "none";
      firebaseBox.style.background = "rgba(0,128,0,0.85)";
    }, 3000);

    // ‚è™ Znovu naƒçti tabulku po smaz√°n√≠
    firebase.database().ref("udalosti").once("value").then(snapshot => {
      const data = snapshot.val();
      const keys = Object.keys(data || {}).reverse();
      const udalosti = Object.values(data || {}).reverse();
      zobrazTabulku(udalosti, keys);
    });
  });
}


function zobrazPoznamku(text) {
  console.log("üìù Zobrazuji pozn√°mku:", text); // Debug
  document.getElementById("poznamka-text").innerText = text;
  document.getElementById("poznamka-modal").style.display = "flex";
}

function zavritPoznamku() {
  document.getElementById("poznamka-modal").style.display = "none";
}

function pridatUdalost() {
  const nazev = document.getElementById('nazev').value;
  const typ = document.getElementById('typ').value;
  const stav = document.getElementById('stav').value;
  const poznamka = document.getElementById('poznamka').value;
  const ulice = document.getElementById("ulice").value;
  const mesto = document.getElementById("mesto").value;

  const jednotky = [];
  if (document.getElementById('hzs').checked) jednotky.push("HZS");
  if (document.getElementById('jsdh').checked) jednotky.push("JSDH");
  if (document.getElementById('pcr').checked) jednotky.push("PƒåR");
  if (document.getElementById('zzs').checked) jednotky.push("ZZS");

  if (jednotky.length === 0) {
    const firebaseBox = document.getElementById("firebase-box");
    firebaseBox.innerText = "‚õî Mus√≠≈° vybrat alespo≈à jednu jednotku (HZS, JSDH, PƒåR, ZZS)";
    firebaseBox.style.background = "rgba(200,0,0,0.85)";
    firebaseBox.style.display = "block";

    setTimeout(() => {
      firebaseBox.style.display = "none";
      firebaseBox.style.background = "rgba(0,128,0,0.85)";
    }, 3000);
    return;
  }

  const zvuk = document.getElementById("zvuk-udalosti");
  zvuk.muted = false;
  zvuk.play();

  zvuk.onended = () => {
    zvuk.onended = null;

    const typText = {
      "P": "Po≈æ√°r",
      "DN": "Dopravn√≠ nehoda",
      "TP": "Technick√° pomoc",
      "ZOZ": "Z√°chrana osob a zv√≠≈ôat",
      "UNL": "√önik nebezpeƒçn√Ωch l√°tek",
      "POP": "Poplach",
      "OST": "Ostatn√≠ ud√°lost"
    };

    const hlaseniText = `Pozor poplach! Nov√° ud√°lost. ${typText[typ] || nazev} Ulice ${ulice} ${mesto}. ${typText[typ] || nazev} ${poznamka || "bez pozn√°mky"}. Vyjede: ${jednotky.join(", ")}.`;

// üîÅ Poslat hl√°≈°en√≠ ostatn√≠m z√°lo≈æk√°m
kanal.postMessage({
  typ: "hlaseni",
  text: hlaseniText,
  odesilatel: mojeId
});

// üîä Lok√°ln√≠ hlasov√© hl√°≈°en√≠
const hlaseni = new SpeechSynthesisUtterance(hlaseniText);
hlaseni.lang = "cs-CZ";
hlaseni.rate = 0.95;
hlaseni.pitch = 0.9;
hlaseni.volume = 1;

const hlasy = speechSynthesis.getVoices();
const ceskyHlas = hlasy.find(h => h.lang === "cs-CZ" && h.name.includes("Google"));
if (ceskyHlas) {
  hlaseni.voice = ceskyHlas;
}

hlaseni.onend = () => {
  speechSynthesis.cancel();
  zvuk.currentTime = 0;
  zvuk.play();
};

speechSynthesis.speak(hlaseni);
  };

  // üïí ƒåas vyhl√°≈°en√≠
  const casVyhlaseni = new Date().toLocaleString("cs-CZ", {
    day: "2-digit",
    month: "2-digit",
    year: "numeric",
    hour: "2-digit",
    minute: "2-digit",
    second: "2-digit"
  });

  // üìç Marker na mapƒõ
  const marker = L.marker([kliknuteLatLng.lat, kliknuteLatLng.lng], {
    icon: ikony[typ]
  }).addTo(map);

  marker.bindPopup(
    `<div style="font-size:1.3em; font-weight:bold; margin-bottom:5px;">${nazev}</div>
     <div><strong>ƒåas:</strong> ${casVyhlaseni}</div>
     <div><strong>Adresa:</strong> ${ulice}, ${mesto}</div>
     <div><strong>Jednotky:</strong> ${jednotky.join(", ")}</div>
     <div><i>${poznamka}</i></div>`
  ).openPopup();

  // üî• Z√°pis do Firebase
  firebase.database().ref("udalosti").push({
    casVyhlaseni,
    nazev,
    typ,
    ulice,
    mesto,
    stav,
    poznamka,
    jednotky: jednotky.join(", "),
    lat: kliknuteLatLng.lat,
    lng: kliknuteLatLng.lng
  }).then(() => {
    const firebaseBox = document.getElementById("firebase-box");
    firebaseBox.innerText = "‚úÖ Ud√°lost byla √∫spƒõ≈°nƒõ p≈ôid√°na!";
    firebaseBox.style.display = "block";

    setTimeout(() => {
      firebaseBox.style.display = "none";
    }, 3000);

    firebase.database().ref("udalosti").once("value").then(snapshot => {
      const data = snapshot.val();
      const keys = Object.keys(data || {}).reverse();
      const udalosti = Object.values(data || {}).reverse();
      zobrazTabulku(udalosti, keys);
    });
  });

}

function zobrazTabulku(udalosti, keys) {
  const thead = document.querySelector("#tabulka thead");
  thead.innerHTML = `
    <tr>
      <th>ƒåas</th>
      <th>N√°zev</th>
      <th>Typ</th>
      <th>Ulice</th>
      <th>Mƒõsto</th>
      <th>Stav</th>
      <th>Jednotky</th>
      <th>Popis ud√°losti</th>
      ${prihlaseny ? "<th>Akce</th>" : ""}
    </tr>
  `;

  const tbody = document.querySelector("#tabulka tbody");
  tbody.innerHTML = "";

  udalosti.forEach((u, index) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${u.casVyhlaseni || "-"}</td>
      <td>${u.nazev}</td>
      <td>${u.typ}</td>
      <td>${u.ulice || "-"}</td>
      <td>${u.mesto || "-"}</td>
      <td>
        ${prihlaseny ? `
          <select onchange="aktualizujStav(this.value, ${index})">
            <option ${u.stav === "P≈ôijat√°, SaP na cestƒõ" ? "selected" : ""}>P≈ôijat√°, SaP na cestƒõ</option>
            <option ${u.stav === "Otev≈ôen√°, SaP na m√≠stƒõ" ? "selected" : ""}>Otev≈ôen√°, SaP na m√≠stƒõ</option>
            <option ${u.stav === "Lokalizace" ? "selected" : ""}>Lokalizace</option>
            <option ${u.stav === "Likvidace" ? "selected" : ""}>Likvidace</option>
            <option ${u.stav === "P≈ôevzat√° VZ" ? "selected" : ""}>P≈ôevzat√° VZ</option>
            <option ${u.stav === "P≈ôevzat√° PƒåR" ? "selected" : ""}>P≈ôevzat√° PƒåR</option>
            <option ${u.stav === "Uzav≈ôen√° OS" ? "selected" : ""}>Uzav≈ôen√° OS</option>
          </select>
        ` : `<span>${u.stav}</span>`}
      </td>
      <td>${u.jednotky || "-"}</td>
      <td>
        ${u.poznamka
          ? `${u.poznamka.length > 10
              ? `${u.poznamka.slice(0, 13)}... <span class="info-icon" onclick="zobrazPoznamku('${u.poznamka}')">‚ÑπÔ∏è</span>`
              : u.poznamka}`
          : "-"}
      </td>
      ${prihlaseny ? `<td><button onclick="smazatUdalost('${keys[index]}')">üóëÔ∏è</button></td>` : ""}
    `;
    tbody.appendChild(tr);
  });
}


function vygenerujAdresu() {
  const uliceSeznam = [
    "Masarykova", "Dlouh√°", "Komensk√©ho", "Husova", "≈†koln√≠",
    "N√°dra≈æn√≠", "Jir√°skova", "Palack√©ho", "Smetanova", "Tyr≈°ova",
    "Na V√Ωslun√≠", "Pod P√°te≈ô√≠", "U Lesa", "Kpt. Jaro≈°e", "U H≈ôi≈°tƒõ", "Zahradn√≠", "Cimrmanova", "Sluneƒçn√°", "Politick√°",
  ];

  const mestaSeznam = [
    "√öst√≠ nad Labem", "Praha", "Kl√°≈°terec nad Oh≈ô√≠", "Teplice", "Dƒõƒç√≠n", "Litomƒõ≈ôice", "Most",
    "Chomutov", "Louny", "Roudnice nad Labem", "B√≠lina", "≈Ωatec", "Praha 2", "Praha 3", "Praha 4", "Brno", "Ostrava"
  ];

  const nahodnaUlice = uliceSeznam[Math.floor(Math.random() * uliceSeznam.length)];
  const nahodneCislo = Math.floor(Math.random() * 200) + 1;
  const nahodneMesto = mestaSeznam[Math.floor(Math.random() * mestaSeznam.length)];

  document.getElementById("ulice").value = `${nahodnaUlice} ${nahodneCislo}`;
  document.getElementById("mesto").value = nahodneMesto;
}

function aktualizujStav(novyStav, index) {
  firebase.database().ref("udalosti").once("value").then(snapshot => {
    const data = snapshot.val();
    const keys = Object.keys(data || {}).reverse();
    const key = keys[index];
    firebase.database().ref("udalosti/" + key).update({ stav: novyStav });
  });
}

function aktualizujStav(novyStav, index) {
  if (!prihlaseny) {
    alert("‚õî Jen spr√°vce m≈Ø≈æe mƒõnit stav ud√°losti.");
    return;
  }

  firebase.database().ref("udalosti").once("value").then(snapshot => {
    const data = snapshot.val();
    const keys = Object.keys(data || {}).reverse();
    const key = keys[index];
    firebase.database().ref("udalosti/" + key).update({ stav: novyStav });
  });
}

function aktualizujPoznamku(novaPoznamka, index) {
  firebase.database().ref("udalosti").once("value").then(snapshot => {
    const data = snapshot.val();
    const keys = Object.keys(data || {}).reverse();
    const key = keys[index];
    firebase.database().ref("udalosti/" + key).update({ poznamka: novaPoznamka });
  });
}

function vymazatUdalosti() {
  if (confirm("Opravdu chce≈° smazat v≈°echny ud√°losti?")) {
    firebase.database().ref("udalosti").remove().then(() => {
      alert("‚úÖ V≈°echny ud√°losti byly smaz√°ny.");
      location.reload();
    });
  }
}

let prihlaseny = false; // ‚Üê mus√≠ b√Ωt glob√°lnƒõ

function overitHeslo() {
  const heslo = document.getElementById("heslo").value;
  if (heslo === "HZSJSDHFIVEPD") {
    prihlaseny = true;
    document.getElementById("form-box").style.display = "block";
    document.getElementById("heslo-box").style.display = "none";
    vygenerujAdresu();

    // ‚è™ Znovu naƒçti tabulku s tlaƒç√≠tky üóëÔ∏è
    firebase.database().ref("udalosti").once("value").then(snapshot => {
      const data = snapshot.val();
      const keys = Object.keys(data || {}).reverse();
      const udalosti = Object.values(data || {}).reverse();
      zobrazTabulku(udalosti, keys);
    });

  } else {
    const firebaseBox = document.getElementById("firebase-box");
    firebaseBox.innerText = "‚õî ≈†patn√© heslo. P≈ô√≠stup zam√≠tnut.";
    firebaseBox.style.background = "rgba(200,0,0,0.85)";
    firebaseBox.style.display = "block";

    setTimeout(() => {
      firebaseBox.style.display = "none";
      firebaseBox.style.background = "rgba(0,128,0,0.85)";
    }, 5000);
  }
}


function ulozitAOdhlasit() {
  const firebaseBox = document.getElementById("firebase-box");
  firebaseBox.innerText = "üíæ Zmƒõny byly ulo≈æeny.";
  firebaseBox.style.background = "rgba(0,128,0,0.85)";
  firebaseBox.style.display = "block";

  setTimeout(() => {
    firebaseBox.style.display = "none";
  }, 3000);

  prihlaseny = false;
  document.getElementById("form-box").style.display = "none";
  document.getElementById("heslo-box").style.display = "block";

  // ‚è™ Znovu naƒçti tabulku bez pr√°v spr√°vce
  firebase.database().ref("udalosti").once("value").then(snapshot => {
    const data = snapshot.val();
    const keys = Object.keys(data || {}).reverse();
    const udalosti = Object.values(data || {}).reverse();
    zobrazTabulku(udalosti, keys);
  });
}

window.onload = function () {
  // ‚úÖ Aktivace hlasov√©ho enginu po prvn√≠m kliknut√≠
  document.body.addEventListener("click", () => {
    const dummy = new SpeechSynthesisUtterance("");
    speechSynthesis.speak(dummy);
  }, { once: true });

  // üîÅ Naƒçten√≠ dat z Firebase
  firebase.database().ref("udalosti").on("value", snapshot => {
    const data = snapshot.val();
    const keys = Object.keys(data || {}).reverse();
    const udalosti = Object.values(data || {}).reverse();

    // Zobraz markery na mapƒõ
    udalosti.forEach(u => {
      const marker = L.marker([u.lat, u.lng], { icon: ikony[u.typ] }).addTo(map);
      marker.bindPopup(
        `<div style="font-size:1.4em; font-weight:bold; margin-bottom:5px;">${u.nazev}</div>
         <div><strong>ƒåas:</strong> ${u.casVyhlaseni}</div>
         <div><strong>Typ:</strong> ${u.typ}</div>
         <div><strong>Stav:</strong> ${u.stav}</div>
         <div><strong>Adresa:</strong> ${u.ulice}, ${u.mesto}</div>
         <div><strong>Jednotky:</strong> ${u.jednotky}</div>
         <div><i>${u.poznamka}</i></div>`
      );
    });

    zobrazTabulku(udalosti, keys);
  });
};


  setTimeout(() => {
    location.reload();
  }, 180000); // 3 minuty
</script>
</body>
</html>
